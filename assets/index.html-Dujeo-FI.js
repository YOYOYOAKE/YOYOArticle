import{_ as i,c as a,a as e,o as n}from"./app-BvfsiuvN.js";const t={};function l(h,s){return n(),a("div",null,[...s[0]||(s[0]=[e(`<blockquote><p>BUCEA 校园网按流量计费，每 G 下行流量 0.5 元，这谁用得起？</p><p>一个想法就是使用 5G 流量替代校园网，如手机通过 USB 共享网络。但是我在宿舍和实验室各有一台电脑，均需要网络连接。如果各配置一台 5G 手机的话，硬件成本和流量成本直接翻倍。</p><p>因此尝试将其中一台电脑的流量转发到另一台电脑上。</p></blockquote><h2 id="_1-网络连通性检查" tabindex="-1"><a class="header-anchor" href="#_1-网络连通性检查"><span>1 网络连通性检查</span></a></h2><p>在谈论一切之前，首先要保证两台电脑能相互连接。首先使用<code>ipconfig</code>查看 IP：</p><table><thead><tr><th style="text-align:center;"></th><th style="text-align:center;">电脑 A</th><th style="text-align:center;">电脑 B</th></tr></thead><tbody><tr><td style="text-align:center;">IPv4</td><td style="text-align:center;">10.100.x.a</td><td style="text-align:center;">10.100.y.b</td></tr><tr><td style="text-align:center;">子网掩码</td><td style="text-align:center;">255.255.192.0</td><td style="text-align:center;">255.255.192.0</td></tr><tr><td style="text-align:center;">网关</td><td style="text-align:center;">10.100.0.1</td><td style="text-align:center;">10.100.0.1</td></tr></tbody></table><p>这两台设备的子网掩码均为<code>255.255.192.0</code>，计算得到覆盖的 IP 范围为<code>10.100.0.0</code>~<code>10.100.63.255</code>。两台设备的 IP 均在此范围内，因此理论可以相互访问。</p><p>首先两台电脑互 Ping，成功。但是 Ping 通了不代表其他服务也能连接，还需要使用 SSH、SMB、Windows 远程桌面等多种方式检查连接情况。</p><p>这里很幸运，除了 80 和 443 端口外，校园网没有进行过多的限制。在校园网环境下两台电脑可以使用其他端口可以相互访问。</p><p>如果不幸校园网进行了严格封堵，可以尝试使用 <a href="https://www.zerotier.com/" target="_blank" rel="noopener noreferrer">ZeroTier</a> 进行虚拟组网。</p><h2 id="_2-全局流量转发" tabindex="-1"><a class="header-anchor" href="#_2-全局流量转发"><span>2 全局流量转发</span></a></h2><p>流量转发的方式有很多。较底层的如修改路由表，性能最高，但配置难度也最大，出错后改正也极其麻烦。综合性能和灵活性等因素，采用 Clash 将电脑 B 处的流量全局转发到电脑 A。</p><p>A 处的 Clash 只需开启允许局域网访问即可，端口默认为<code>7890</code>。</p><p>B 处的 Clash 则进行全局流量转发，配置文件内容如下：</p><div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-yaml"><span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">port</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 7890</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">allow-lan</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> false</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">mode</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> Rule</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">log-level</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> info</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">external-controller</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 127.0.0.1:9090</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">tun</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  enable</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> true</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  stack</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> system</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  dns-hijack</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">    -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 198.18.0.2:53</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  auto-route</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> true</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  auto-detect-interface</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> true</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 代理出口</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">proxies</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">  -</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;"> name</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">YOYOProxy</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">    type</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> socks5</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">    server</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 10.100.x.a</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">    port</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 7890</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 代理组</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">proxy-groups</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">  -</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;"> name</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">全局流量转发</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">    type</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> select</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">    proxies</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">      -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> YOYOProxy</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 分流规则</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">rules</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">  -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> MATCH,GLOBAL</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这里启用了 TUN 模式。该模式创建一个虚拟网卡拦截所有流量，再走代理规则。相较于系统代理，TUN 模式性能略低，但优势在于应用内无感知，且支持 TCP/UDP。更别说并非所有软件都遵守系统代理。</p><p>导入配置文件后，在 Clash 内启用规则模式代理即可。</p><p>B 处的 Clash 日志出现类似于下述文本时，则说明成功拦截并转发流量到 YOYOProxy（即 A）。</p><div class="language-text line-numbers-mode" data-highlighter="shiki" data-ext="text" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-text"><span class="line"><span>..., RULE: Match(), PROXY: GLOBAL[YOYOProxy]</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>此时 A 处的 Clash 日志应该类似于：</p><div class="language-text line-numbers-mode" data-highlighter="shiki" data-ext="text" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-text"><span class="line"><span>FROM: 10.100.y.b:54204, ...</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>这说明 A 成功接收到了来自 B 的流量。</p>`,20)])])}const k=i(t,[["render",l]]),r=JSON.parse('{"path":"/article/27owyzmn/","title":"Clash 全局流量转发","lang":"zh-CN","frontmatter":{"title":"Clash 全局流量转发","createTime":"2025/08/28 09:03:13","permalink":"/article/27owyzmn/","tags":["Others"],"description":"BUCEA 校园网按流量计费，每 G 下行流量 0.5 元，这谁用得起？ 一个想法就是使用 5G 流量替代校园网，如手机通过 USB 共享网络。但是我在宿舍和实验室各有一台电脑，均需要网络连接。如果各配置一台 5G 手机的话，硬件成本和流量成本直接翻倍。 因此尝试将其中一台电脑的流量转发到另一台电脑上。 1 网络连通性检查 在谈论一切之前，首先要保证两...","head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Clash 全局流量转发\\",\\"image\\":[\\"\\"],\\"dateModified\\":null,\\"author\\":[]}"],["meta",{"property":"og:url","content":"https://www.yoake.cc/article/27owyzmn/"}],["meta",{"property":"og:site_name","content":"YOYOArticle"}],["meta",{"property":"og:title","content":"Clash 全局流量转发"}],["meta",{"property":"og:description","content":"BUCEA 校园网按流量计费，每 G 下行流量 0.5 元，这谁用得起？ 一个想法就是使用 5G 流量替代校园网，如手机通过 USB 共享网络。但是我在宿舍和实验室各有一台电脑，均需要网络连接。如果各配置一台 5G 手机的话，硬件成本和流量成本直接翻倍。 因此尝试将其中一台电脑的流量转发到另一台电脑上。 1 网络连通性检查 在谈论一切之前，首先要保证两..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"article:tag","content":"Others"}]]},"readingTime":{"minutes":2.43,"words":728},"git":{},"autoDesc":true,"filePathRelative":"articles/250901-全局流量转发.md","headers":[],"categoryList":[]}');export{k as comp,r as data};
