---
title: Part 5 React 状态
createTime: 2025/06/30 09:32:11
permalink: /react/base/05/
---

React 是函数式编程，而由于函数式编程无副作用的特点，React 组件是无法保存状态的。

例如：

```tsx
function App() {
  let title: string = "示例标题"

  const handleClick = () => {
    title = "标题已更改"
  }

  return (
    <>
      <h3>{title}</h3>
      <button onClick={handleClick}>点击更改标题</button>
    </>
  )
}
```

预期中组件的行为应该是：点击按钮，然后标题被更改。而当我们真正点击按钮时却什么都没有发生，即使按钮中的语句确实被执行了。

这是由于 React 并没有提供像 Vue 一样的响应式机制，声明的`title`只是一个普通变量，并不会影响到 DOM。

为了解决这个问题，React 提供了`useState`方法。

`useState`是一个函数，它接收一个 JS 字面量作为参数，也是数据的初始内容。`useState`返回一个数组，第一个元素是对初始内容的**引用**，或者称为`state`，第二个元素是一个修改内容的函数，或者称为`setState`。

## 1 简单数据类型状态

`setState`可以接收一个 JS 字面量，直接赋值给 state。

```tsx
function App() {
  const [title, setTitle] = useState("初始标题")

  const handleClick = () => {
    setTitle("标题已更改")
  }

  return (
    <>
      <h3>{title}</h3>
      <button onClick={handleClick}>点击更改标题</button>
    </>
  )
}
```

也可以接收一个函数，用于实现更复杂的逻辑。这个函数默认接收“前一个 state”作为第一个参数。

```tsx
function App() {
  const [count, setCount] = useState(1)

  const handleClick = () => {
    setCount(prevCount => prevCount + 1)
  }

  return (
    <>
      <h3>{count}</h3>
      <button onClick={handleClick}>Click</button>
    </>
  )
}
```

## 2 引用数据类型状态

### 2.1 对象

对于一个引用数据类型而言，修改其状态容易陷入这样的陷阱：

```tsx
function App() {
  const [info, setInfo] = useState({
    name: "YOAKE",
    age: 18,
  })

  const handleClick = () => {
    setInfo(prevInfo => ({
      age: prevInfo.age + 1,
    }))
  } // 事实上，在 TSX 中，这一行连编译都过不去

  return (
    <>
      <div>
        {info.name}今年{info.age}岁了
      </div>
      <button onClick={handleClick}>年龄+1</button>
    </>
  )
}
```

当我们点击按钮时，会发现 DOM 中的`info.name`消失了。这说明`setState`的直接赋值方式对于引用数据类型是整体替换，而非我们预期中的更新。

要实现预期行为，需要重写所有属性。当然我们可以借助展开运算符，以避免重写所有属性：

```tsx
setInfo(prevInfo => ({
  ...prevInfo,
  age: prevInfo.age + 1,
}))
```

### 2.2 数组

对于数组而言，展开运算符也经常出现：

```tsx
function App() {
  const [list, setList] = useState([
    { id: 1, name: "YOAKE" },
    { id: 2, name: "AJohn" },
    { id: 3, name: "Zephyr" },
  ])

  const handleClick = () => {
    setList([
      ...list, 
      { id: 4, name: "清歌" }
    ])
  }

  return (
    <>
      <ul>
        {list.map(item => (
          <li key={item.id}>
            {item.id} - {item.name}
          </li>
        ))}
      </ul>
      <button onClick={handleClick}>点击加一个人</button>
    </>
  )
}
```

当然可以调整位置，将其添加到列表首位：

```tsx
const handleClick = () => {
  setList([
    { id: 4, name: "清歌" }, 
    ...list
  ])
}
```

结合数组方法，我们可以添加进任何位置，虽然略显麻烦就是了。